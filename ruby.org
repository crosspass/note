* Ruby Source Code Dig

** matz ruby verital machine

#+BEGIN_SRC shell

     ruby file                VM(cruby)
     *************            *********
     *           *-----------> *       *
     *************              *********

#+END_SRC

*** VM(cruby):

#+BEGIN_SRC shell
               ./autoconf                    ./configure
/Makefile.ac  ------------>  ./Makeifile.in --------------> ./GNUmakefile
#+END_SRC

My computer enviroment is MacOS Mojave 10.14.3

so let's dig Makefile

share object libary

#+BEGIN_SRC
  tool/node_name.rb node.h
       |             |
       |             |
       +-------------+
             |
             v
        node_name.inc
#+END_SRC

* src
node.h is for what?

rb_ast_tree


dir: tool/ruby/vm_/ generate *.inc files


#+BEGIN_SRC

  +-----------+  bison      +-----+   yarv     +------+
  | ruby code |----------->| ast |----------->| insn |
  +-----------+            +-----+            +------+

  example:

  soruce e.rb

  class A                            rb_class_t A
    def p
      puts 'Hello ruby!'      --->   rb_method_t p
    end
                                     rb_method_t p2
    def self.p2
      puts 'Hello class ruby!'
    end
  end

  typedef struct {
    char * name;
  } RbMethod;

  typedef struct {
    char * name;
    Method class_methods[10];
    Method methods[10];
  } RbClass;

  type struct AST_NODE {
    AST_NODE * next_node;
    Function functions[]
  }

  constants table
   type struct  {
     char *name;     
   } constant_t 

   = CONSTANTS = 
   +-------+
   |'A'    |
   +-------+

#+END_SRC

some simple ruby code translate into c language and execute
